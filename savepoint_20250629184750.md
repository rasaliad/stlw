# SAVEPOINT: Sistema STL - Warehouse Management System
**Fecha:** 2025-06-29 18:47:50
**Estado:** Funcional con m√≥dulos principales implementados

## üìã RESUMEN EJECUTIVO

Sistema de gesti√≥n de almac√©n (WMS) que integra una API SAP-STL personalizada con base de datos Firebird local. El sistema cuenta con autenticaci√≥n JWT, roles de usuario, sincronizaci√≥n de datos en tiempo real y una interfaz moderna con dise√±o cream/pastel.

## üèóÔ∏è ARQUITECTURA T√âCNICA

### Backend
- **Framework:** FastAPI (Python 3.12)
- **Base de Datos:** Firebird 2.5 (externa en `C:\App\STL\Datos\DATOS_STL.FDB`)
- **Autenticaci√≥n:** JWT con roles (ADMINISTRADOR/OPERADOR)
- **API Externa:** SAP-STL (https://dependent-vehicle-victory-por.trycloudflare.com)
- **Contenedor:** Docker con acceso a BD externa v√≠a host.docker.internal

### Frontend
- **Framework:** Next.js 14.0.4 con TypeScript
- **UI Library:** Tailwind CSS + shadcn/ui
- **Estado:** React hooks + API calls con Axios
- **Tema:** Sistema cream/pastel con soporte dark mode
- **Contenedor:** Docker con Node.js 18 Alpine

## üìÅ ESTRUCTURA DE ARCHIVOS CLAVE

```
/home/rasaliad/app/stlw/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py (configuraci√≥n y variables de entorno)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py (conexi√≥n Firebird)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ security.py (JWT y hashing)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes.py (router principal)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deps.py (dependencias de autenticaci√≥n)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ endpoints/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ users.py
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ dispatches.py
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ goods_receipts.py
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ items.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_service.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sap_stl_client.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sap_stl_sync_service.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routers/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ sap_stl.py
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ frontend/
    ‚îú‚îÄ‚îÄ src/
    ‚îÇ   ‚îú‚îÄ‚îÄ app/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx (login)
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/page.tsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ productos/page.tsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ despachos/page.tsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ recepciones/page.tsx
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usuarios/page.tsx
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ configuracion/page.tsx
    ‚îÇ   ‚îú‚îÄ‚îÄ components/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app-layout.tsx (sidebar fijo + header sticky)
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sidebar.tsx
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user-table.tsx
    ‚îÇ   ‚îî‚îÄ‚îÄ lib/
    ‚îÇ       ‚îî‚îÄ‚îÄ api.ts (cliente axios configurado)
    ‚îî‚îÄ‚îÄ Dockerfile
```

## üóÑÔ∏è ESTRUCTURA DE BASE DE DATOS

### Tablas Principales
- **USERS**: id, username, email, hashed_password, is_active, role, created_at, updated_at
- **STL_ITEMS**: 616 productos sincronizados
- **STL_DISPATCHES**: 43 despachos con sync_status
- **STL_DISPATCH_LINES**: 407 l√≠neas de detalle
- **STL_GOODS_RECEIPTS**: 22 recepciones
- **STL_GOODS_RECEIPT_LINES**: 48 l√≠neas de detalle
- **STL_SYNC_CONFIG**: Configuraci√≥n de sincronizaci√≥n por entidad
- **STL_SYNC_LOG**: Registro de operaciones de sincronizaci√≥n

## ‚úÖ M√ìDULOS IMPLEMENTADOS

### 1. **Autenticaci√≥n y Seguridad**
- Login con JWT tokens
- Roles: ADMINISTRADOR y OPERADOR
- Protecci√≥n de rutas por rol
- Logout y manejo de sesiones

### 2. **Dashboard**
- Vista general del sistema
- Estad√≠sticas en tiempo real
- Accesos r√°pidos a m√≥dulos

### 3. **Gesti√≥n de Usuarios** 
- CRUD completo (Crear, Leer, Actualizar, Eliminar)
- Asignaci√≥n de roles
- Activar/Desactivar usuarios
- B√∫squeda y filtros

### 4. **Despachos (Orders)**
- Lista de 43 despachos reales
- Vista expandible con l√≠neas de detalle
- Filtros por cliente y fechas
- Sincronizaci√≥n manual
- Estad√≠sticas: Total, Hoy, Clientes √∫nicos, Productos

### 5. **Recepciones**
- Lista de 22 recepciones con l√≠neas
- Filtros por suplidor y fechas
- Vista expandible de productos recibidos
- Estad√≠sticas: Total, Hoy, Suplidores √∫nicos, Productos

### 6. **Productos**
- Cat√°logo de 616 productos
- B√∫squeda por c√≥digo/descripci√≥n
- Filtro por familia
- Paginaci√≥n (50 productos/p√°gina)
- Informaci√≥n: c√≥digo, descripci√≥n, familia, UMB, embalaje, d√≠as vencimiento

### 7. **Configuraci√≥n** (Solo Administradores)
- Gesti√≥n de tiempos de sincronizaci√≥n
- Configuraci√≥n por tipo de entidad
- Modo simulaci√≥n on/off
- Estado de conexi√≥n API

## üîß CONFIGURACIONES IMPORTANTES

### Variables de Entorno
```env
SECRET_KEY=your-secret-key-change-in-production
FIREBIRD_HOST=host.docker.internal
FIREBIRD_PORT=3050
FIREBIRD_DATABASE=C:\\App\\STL\\Datos\\DATOS_STL.FDB
FIREBIRD_USER=sysdba
FIREBIRD_PASSWORD=masterkey
SAP_STL_URL=https://dependent-vehicle-victory-por.trycloudflare.com
SAP_STL_USERNAME=STLUser
SAP_STL_PASSWORD=7a6T9IVeUdf5bvRIv
USE_MOCK_SAP_DATA=false
```

### Usuarios del Sistema
- **admin** / admin123 (ADMINISTRADOR)
- **00107036006** / [contrase√±a] (OPERADOR)

## üöÄ COMANDOS √öTILES

```bash
# Iniciar sistema
docker-compose up -d

# Ver logs
docker-compose logs -f

# Reiniciar servicios
docker-compose restart

# Reconstruir sin cach√©
docker-compose build --no-cache
docker-compose up -d

# Conectar a base de datos desde backend
docker-compose exec backend python
>>> from app.core.database import FirebirdConnection
>>> db = FirebirdConnection()
```

## üêõ PROBLEMAS RESUELTOS

1. **Autenticaci√≥n fallida**: Creaci√≥n de archivo deps.py faltante
2. **Role validation error**: Agregado campo ROLE a tabla USERS
3. **Sincronizaci√≥n 2 registros**: Desactivado modo mock para usar API real
4. **CORS errors**: Configuraci√≥n correcta en backend
5. **Endpoint 404 sync**: Cambio de GET a POST y ajuste de rutas
6. **Campos incorrectos BD**: Mapeo correcto RECEIPT_ID, CANTIDAD vs campos esperados
7. **Cache navegador**: M√∫ltiples rebuilds y limpieza de cach√©

## üìù PENDIENTES

- [ ] Resolver error 403 en sync-config endpoint
- [ ] Arreglar DialogTitle warning en componentes
- [ ] Implementar sincronizaci√≥n autom√°tica por tiempo
- [ ] Funcionalidad de exportaci√≥n de datos
- [ ] M√≥dulo de reportes y analytics
- [ ] Notificaciones en tiempo real
- [ ] Logs de auditor√≠a detallados

## üé® CARACTER√çSTICAS UI/UX

- Tema cream/pastel consistente
- Sidebar fijo con scroll independiente
- Header sticky
- Tablas expandibles para ver detalles
- Modo claro/oscuro
- Dise√±o responsivo
- Animaciones suaves
- Iconos Lucide React

## üîÑ ESTADO ACTUAL

El sistema est√° completamente funcional con:
- ‚úÖ Autenticaci√≥n y autorizaci√≥n funcionando
- ‚úÖ Todos los m√≥dulos principales implementados
- ‚úÖ Sincronizaci√≥n con API real (43 despachos, 22 recepciones, 616 productos)
- ‚úÖ Interfaz de usuario completa y navegable
- ‚úÖ Base de datos conectada y sincronizada
- ‚úÖ Docker compose configurado y funcionando

**URLs de Acceso:**
- Frontend: http://localhost:3000
- Backend API: http://localhost:8000
- API Docs: http://localhost:8000/docs

---
*Generado autom√°ticamente por el sistema STL*